<!doctype html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>CF Virtual Contest Options</title>
	<style>
		body { font-family: system-ui, -apple-system, Segoe UI, Roboto; padding: 16px; }
		.field { margin-bottom: 10px; display: flex; flex-direction: column; max-width: 420px; }
		label { font-size: 12px; color: #444; margin-bottom: 4px; }
		input { padding: 6px 8px; font-size: 14px; }
		button { width: fit-content; padding: 8px 12px; }
	</style>
</head>
<body>
	<h1>Options</h1>
	<div class="field">
		<label>Default Codeforces handle</label>
		<input id="handle" placeholder="tourist" />
	</div>
	<div class="field">
		<label>Polling interval (seconds)</label>
		<input id="poll" type="number" min="15" max="300" value="60" />
	</div>
	<div class="field">
		<label><input id="adaptive" type="checkbox" checked /> Adaptive difficulty suggestions</label>
	</div>
	<div class="field">
		<label><input id="nodup" type="checkbox" checked /> Avoid repeating problems across contests</label>
	</div>
	<button id="save">Save</button>

	<script type="module">
		const send = (msg) => new Promise(res => chrome.runtime.sendMessage(msg, res));
		async function load() {
			const resp = await send({ type: 'get_state' });
			const settings = resp.settings || {};
			document.querySelector('#handle').value = settings.codeforcesHandle || '';
			document.querySelector('#poll').value = settings.pollIntervalSec || 60;
			document.querySelector('#adaptive').checked = !!settings.adaptiveDifficulty;
			document.querySelector('#nodup').checked = !!settings.noDuplicateAcrossContests;
		}
		document.querySelector('#save').addEventListener('click', async () => {
			const payload = {
				codeforcesHandle: document.querySelector('#handle').value.trim(),
				pollIntervalSec: Math.max(15, Math.min(300, parseInt(document.querySelector('#poll').value || '60', 10))),
				adaptiveDifficulty: document.querySelector('#adaptive').checked,
				noDuplicateAcrossContests: document.querySelector('#nodup').checked
			};
			const resp = await send({ type: 'save_settings', payload });
			if (!resp.ok) alert('Failed to save settings: ' + resp.error);
		});
		load();
	</script>
</body>
</html>
